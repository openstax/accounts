<%
  password_input_tag = 'password-input-tag'
  @min_passw_length ||= Identity::MIN_PASSWOROD_LENGTH
%>

<div id="login-signup-form">
    <div class="content">
        <%= render partial: 'tab_group', locals: { active_class: 'login--active'} %>

        <%= newflow_login_signup_card(
                    classes: "login-page",
                    header: I18n.t(:"login_signup_form.setup_your_new_password")) do %>
            <% lev_form_for :setup_password_form, url: newflow_setup_password_post_path do |f| %>
                <% fh = NewflowFormHelper::Newflow.new(f: f,
                                            context: self,
                                            errors: @handler_result&.errors) %>

                <div class="content control-group info-message">
                    <%= I18n.t(
                                :"login_signup_form.setup_your_new_password_description",
                                email: @email,
                                edit_your_email: link_to(
                                    I18n.t(:"login_signup_form.edit_your_email"), change_your_email_path
                                )
                            ).html_safe
                    %>
                </div>

                <div class="content control-group" id="password-field-container">
                    <%= label_tag :password, I18n.t(:"login_signup_form.password_label"),
                                class: 'field-label required'
                    %>
                    <div class="input-with-tooltip">
                        <%
                            # Note the f.text_field instead of fh.text_field â€“ to not create a wrapper div
                            # which would break the tooltip
                        %>
                        <%= f.text_field :password,
                                                     type: :password,
                                                     placeholder: I18n.t(:"login_signup_form.password_label"),
                                                     class: password_input_tag
                        %>

                        <div class="tooltip">
                            <h4>Password requirements</h4>
                            <div>
                                <i id="password-requirements-check"
                                    class="fa fa-check-circle"
                                    style="font-size: 2rem; color: #c1c1c1">
                                </i>
                                <%= @min_passw_length.to_s %> characters minimum
                            </div>
                        </div>

                        <span id="show-hide-button">
                            <span class="toggle-show-hide">SHOW</span>
                            <span class="toggle-show-hide" style="display: none">HIDE</span>
                        </span>
                    </div>
                </div>
                <br />

                <div class="content">
                    <%= f.submit I18n.t(:"login_signup_form.log_in"),
                                        disable_with: I18n.t(:"login_signup_form.log_in"),
                                        class: 'primary' %>
                </div>

            <% end %>
        <% end %>
    </div>
</div>

<script type="text/javascript">
    var pwd_input = document.getElementsByClassName("<%= password_input_tag %>")[0];
    var pwd_checkmark = document.getElementById('password-requirements-check');

    pwd_input.oninput = function(event){
        if (pwd_input.value.length >= <%= @min_passw_length %>) {
            pwd_checkmark.style.color = 'green';
        } else {
            pwd_checkmark.style.color = '#c1c1c1';
        }
    }
</script>
