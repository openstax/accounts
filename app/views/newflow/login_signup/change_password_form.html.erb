<%
  @min_passw_length ||= Identity::MIN_PASSWORD_LENGTH
%>

<div id="login-signup-form">
    <div class="content">
        <%= render partial: 'tab_group', locals: { active_class: 'login--active'} %>

        <%= newflow_login_signup_card(
                    classes: "login-page",
                    header: I18n.t(:"login_signup_form.enter_new_password")) do %>
            <% lev_form_for :change_password_form, url: change_password_path do |f| %>
                <% fh = NewflowFormHelper::Newflow.new(f: f,
                                            context: self,
                                            errors: @handler_result&.errors) %>
                <div class="content control-group info-message">
                    <%= I18n.t(:"login_signup_form.enter_new_password_description").html_safe %>
                </div>

                <div class="content control-group">
                    <div id="password-field-container">
                        <%= label_tag :password, I18n.t(:"login_signup_form.password_label"),
                                                  class: 'field-label required'
                        %>
                        <div class="input-with-tooltip">
                            <%=
                                    fh.text_field(
                                        name: :password,
                                        type: :password,
                                        placeholder: I18n.t(:"login_signup_form.password_label")
                                    )
                            %>

                            <div class="tooltip">
                                <h4>Password requirements</h4>
                                <div>
                                    <i id="password-requirements-checkmark"
                                        class="fa fa-check-circle">
                                    </i>
                                    <%= @min_passw_length&.to_s %> characters minimum
                                </div>
                            </div>

                            <span id="show-hide-button">
                                <span class="toggle-show-hide">SHOW</span>
                                <span class="toggle-show-hide" style="display: none">HIDE</span>
                            </span>
                        </div>
                    </div>
                </div>
                <br />

                <div class="content">
                    <% f.hidden_field :token, value: params[:token] %>
                    <%= f.submit I18n.t(:"login_signup_form.log_in"),
                                        disable_with: I18n.t(:"login_signup_form.log_in"),
                                        class: 'primary' %>
                </div>

            <% end %>
        <% end %>
    </div>
</div>

<script>
  var password_input = $('[name$="[password]"]')[0];
  var pwd_checkmark = document.getElementById('password-requirements-checkmark');

  password_input.oninput = function(event){
      if (password_input.value.length >= <%= @min_passw_length %>) {
          pwd_checkmark.classList.add("success");
      } else {
          pwd_checkmark.classList.remove("success");
      }
  }
</script>
