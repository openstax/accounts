<%
  email_prefill_value = current_users_resetting_password_email
  email_prefill_value ||= nil # because otherwise it literally shows "false" in the form's input field
%>

<div id="login-signup-form">
  <div class="content">
    <%= render partial: 'shared/tab_group', locals: { active_class: 'login--active' } %>

    <%= login_signup_card(
          classes:        "login-page",
          header:         (I18n.t(:"login_signup_form.login_page_header")),
          show_exit_icon: true) do %>
      <% lev_form_for :login_form, url: login_path do |f| %>
        <% fh = FormHelper::One.new(f: f, context: self, errors: @handler_result&.errors) %>
        <div class="content social-section">
          <div><%= I18n.t(:"login_signup_form.login_with") %></div>

          <%= render partial: 'social_auth/social_auth_buttons' %>
        </div>

        <%=
          render(
            partial: 'shared/form_divider',
            locals:  {
              dividing_text: I18n.t(:"login_signup_form.or_login_below")
            }
          )
        %>

        <div class="content control-group">
          <%= label_tag :email, I18n.t(:"login_signup_form.email_label"), class: 'field-label required' %>
          <%# input type is text instead of email bc we also support usernames %>
          <%= fh.text_field name: :email,
                            value: email_prefill_value,
                            placeholder: I18n.t(:"login_signup_form.email_placeholder"),
                            readonly: email_prefill_value.present?
          %>

        </div>

        <%= render partial: 'passwords/password_control_group', locals: { fh: fh } %>

        <div class="content">
          <%= f.submit I18n.t(:"login_signup_form.continue_button"),
                       disable_with: I18n.t(:"login_signup_form.continue_button"),
                       class:        'primary'
          %>
        </div>

        <div class="content">
          <%=
            link_to(
              I18n.t(:"login_signup_form.forgot_password"),
              password_send_reset_path,
              id:     'forgot-password-link',
              method: :post
            )
          %>
        </div>
      <% end %>
    <% end %>
  </div>
  <%= javascript_include_tag 'ko_extensions' %>
</div>
<script>
    // Necessary for password
    ko.applyBindings({});
</script>
