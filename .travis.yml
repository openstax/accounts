dist: xenial
language: ruby # the version is specified in .ruby-version
cache: bundler
before_install:
  # Requirements for Ruby 2.3.x and Rails 4.2.x
  # See https://docs.travis-ci.com/user/languages/ruby/#bundler-20
  - gem uninstall -v '>= 2' -i $(rvm gemdir)@global -ax bundler || true
  - gem install bundler -v '< 2'
bundler_args: --without=production --retry=6
env: OXA_DB_USER=postgres OXA_TEST_DB=travis_ci_test PARALLEL_TEST_PROCESSORS=2
addons:
  apt:
    packages:
      - google-chrome-stable
  postgresql: 9.5
services:
  - xvfb
before_script:
  - which google-chrome
  - google-chrome --version
  - bundle exec rake webdrivers:chromedriver:version
  - bundle exec rake webdrivers:chromedriver:update[73.0.3683.68]
  - bundle exec rake webdrivers:chromedriver:version
  - google-chrome --version
  - bundle exec rake --trace parallel:create parallel:load_schema parallel:seed
script: bundle exec parallel_rspec ./spec
notifications:
  email: false
